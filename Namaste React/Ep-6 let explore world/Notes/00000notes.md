# Ep-6

We know Monolithic vs Microservices !!

On monolithic everyone was having same github repository!! Now in microservices backedn needs to call to APIs!! So we will see it now!!

2 ways to fetch data from backend!!

1. as soon as page loads make API call,wait for data to come and then render UI!! so here need to wait for API response!!

2. as soon as page loads ,Render UI!!after rendering UI we make API call ,after we get data ,we re-render the UI!!

In react we using 2nd approach always!!2nd one give better UX !! we do not use 1st one ,we use 2nd one as first we see skeleton and then we see the data!! so here user do not see any lag!!2 renders are okay !! We need not worry for that!!

## UseEffect Hook

another pre-written function!!

syntax of useEffect ,two parameter passed 

1. callback function
2. dependency array

Callback function is called after the component renders!! Something that needs to be doen after rendering of component then write in callback of useEffect!!

Now we have separated Data from React project and developed springboot backend server!!

>Note:Generally CORS policy block fetching from two different origins ,browser do not allow call from one origin to other!!

from backend i have allowed 

```java
@Configuration
public class Config implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**") // applies to all endpoints
                .allowedOrigins("http://localhost:5173") // only allow Vite dev server
                .allowedMethods("GET", "OPTIONS")
                .allowedHeaders("*");
    }
}


```

but what about public API?

can use allow CORS extension for CORS error!!

```jsx
import RestuarantCard from "./RestuarantCard.jsx";
import {useEffect, useState} from "react";
import {resturantList} from "../utils/data.jsx"
import './Body.css';


const Body = () => {

    let [resturants,setResturants]=useState(resturantList);

    useEffect(() => {fetchdata()})

    const fetchdata = async()=> {
        const data=await fetch("http://localhost:8080/api/res");
        const json=await data.json()
        console.log(json)
    }
    return (
        <div className="body">
            <div className="search-bar"> Search bar</div>
            <div className="filter">
                <button className="filter-btn" onClick={() => {
                    resturants=resturants.filter(
                        (resturant => resturant.stars>4.0)
                    )
                    console.log(resturants);
                    setResturants(resturants);
                }}>
                Top Rated Resturant</button>
            </div>
            <div className="res">
                {resturants.map((restaurant, index) => (
                    <div className="card" key={index}>
                        <RestuarantCard
                            data={restaurant}
                        />
                    </div>
                ))}

            </div>
        </div>
    )
};

export default Body;

```
we able to make call ,now we want to render the data inside our app!! now we will set data inside react and then react will re-render data!!

```jsx


const Body = () => {

    let [resturants,setResturants]=useState([]);

    useEffect(() => {fetchdata()},[])

    const fetchdata = async()=> {
        const data=await fetch("http://localhost:8080/api/res");
        const json=await data.json()
        console.log(json)
        setResturants(json)
    }
    return (
        <div className="body">
            <div className="search-bar"> Search bar</div>
            <div className="filter">
                <button className="filter-btn" onClick={() => {
                    resturants=resturants.filter(
                        (resturant => resturant.stars>4.0)
                    )
                    console.log(resturants);
                    setResturants(resturants);
                }}>
                Top Rated Resturant</button>
            </div>
            <div className="res">
                {resturants.map((restaurant, index) => (
                    <div className="card" key={index}>
                        <RestuarantCard
                            data={restaurant}
                        />
                    </div>
                ))}

            </div>
        </div>
    )
};

export default Body

```

>Note:Put dependency 2nd param of the useState else will keep on loading!!

Now we want till data is loaded to the page we need a spinning loader!! or we can just put Loading ..


```jsx

const Body = () => {

    let [resturants,setResturants]=useState([]);

    useEffect(() => {fetchdata()},[])

    const fetchdata = async()=> {
        const data=await fetch("http://localhost:8080/api/res");
        const json=await data.json()
        console.log(json)
        setResturants(json)
    }

    if(resturants.length==0){
        return <h1>Loading...</h1>
    }
    return (
        <div className="body">
            <div className="search-bar"> Search bar</div>
            <div className="filter">
                <button className="filter-btn" onClick={() => {
                    resturants=resturants.filter(
                        (resturant => resturant.stars>4.0)
                    )
                    console.log(resturants);
                    setResturants(resturants);
                }}>
                Top Rated Resturant</button>
            </div>
            <div className="res">
                {resturants.map((restaurant, index) => (
                    <div className="card" key={index}>
                        <RestuarantCard
                            data={restaurant}
                        />
                    </div>
                ))}

            </div>
        </div>
    )
};

export default Body;

```

But showing loading and these this `loading...` is not good practice ,we can use Shimmer UI (shows fake cards)!!Even YT uses it!!

### Shimmer UI 

``jsx
import './Shimmer.css'

const Shimmer=()=>{
    return <div className="Shimmer">
        <div className="ShimmerCard">Shimmer</div>
        <div className="ShimmerCard">Shimmer</div>
        <div className="ShimmerCard">Shimmer</div>
    </div>
 }

 export default Shimmer;
```

```css
.Shimmer{
    display :flex;
}
.ShimmerCard{
    width:300px;
    height:300px;
    background-color:grey;
    margin:20px;
}
```

just grey cards!!

```jsx
import RestuarantCard from "./RestuarantCard.jsx";
import {useEffect, useState} from "react";
import './Body.css';
import Shimmer from "../Shimmer/Shimmer.jsx";


const Body = () => {

    let [resturants,setResturants]=useState([]);

    useEffect(() => {fetchdata()},[])

    const fetchdata = async()=> {
        const data=await fetch("http://localhost:8080/api/res");
        const json=await data.json()
        console.log(json)
        setResturants(json)
    }

    if(resturants.length==0){
        return <Shimmer/>
    }
    return (
        <div className="body">
            <div className="search-bar"> Search bar</div>
            <div className="filter">
                <button className="filter-btn" onClick={() => {
                    resturants=resturants.filter(
                        (resturant => resturant.stars>4.0)
                    )
                    console.log(resturants);
                    setResturants(resturants);
                }}>
                Top Rated Resturant</button>
            </div>
            <div className="res">
                {resturants.map((restaurant, index) => (
                    <div className="card" key={index}>
                        <RestuarantCard
                            data={restaurant}
                        />
                    </div>
                ))}

            </div>
        </div>
    )
};

export default Body;
```